{% extends "ui/base.html" %}

{% block title %}Generation Progress{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4 dark:text-gray-200">Generating PSADT Script...</h1>
<p class="mb-2 dark:text-gray-400">Package ID: <span class="font-mono">{{ package_id }}</span></p>

<div hx-ext="sse" sse-connect="/v1/progress/{{ package_id }}" hx-trigger="load">
    <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-6 mb-4 dark:bg-gray-700" sse-swap="progressbar" hx-swap="innerHTML">
        <div id="progress-bar" class="bg-indigo-600 h-6 rounded-full text-center text-white" style="width: 0%">
            0%
        </div>
    </div>
    <div id="progress-message" class="text-center dark:text-gray-300" sse-swap="message" hx-swap="innerHTML">
        Initializing...
    </div>
</div>
<script>
    document.body.addEventListener('htmx:sseMessage', function(evt) {
        if (evt.detail.type === 'done') {
            const data = JSON.parse(evt.detail.data);
            window.location.href = data.redirect_url;
        }
    });
</script>
{% endblock %}
